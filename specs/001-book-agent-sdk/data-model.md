# Data Model: Book Agent SDK

## Entities

### Question
- **Definition**: A user query submitted to the system about book content
- **Fields**:
  - `id` (string, required): Unique identifier for the question
  - `content` (string, required): The text of the user's question
  - `book_id` (string, optional): Identifier for the specific book (if multiple books supported)
  - `timestamp` (datetime, required): When the question was submitted
  - `selected_text` (string, optional): Relevant text selected by user when asking the question

### Book Content Chunk
- **Definition**: Segments of book content stored in the vector database for retrieval
- **Fields**:
  - `id` (string, required): Unique identifier for the chunk
  - `content` (string, required): The text content of the chunk
  - `book_id` (string, required): Identifier for the book this chunk belongs to
  - `chapter` (string, optional): Chapter or section information
  - `page_number` (integer, optional): Page number in the original book
  - `document_position` (integer, required): Position of this chunk in the document
  - `embedding` (list[float], required): Vector embedding representation of the content
  - `metadata` (dict, optional): Additional metadata about the content chunk

### Answer
- **Definition**: Response generated by the agent based on retrieved book content
- **Fields**:
  - `id` (string, required): Unique identifier for the answer
  - `question_id` (string, required): Reference to the question being answered
  - `content` (string, required): The text answer to the question
  - `timestamp` (datetime, required): When the answer was generated
  - `confidence_score` (float, optional): Confidence score of the answer (0.0-1.0)

### Source Reference
- **Definition**: Specific citation to the book content chunk(s) used to generate an answer
- **Fields**:
  - `id` (string, required): Unique identifier for the source reference
  - `answer_id` (string, required): Reference to the answer this source relates to
  - `chunk_id` (string, required): Reference to the book content chunk used
  - `relevance_score` (float, required): Relevance score of this chunk to the question (0.0-1.0)
  - `content_snippet` (string, required): Excerpt from the referenced content
  - `source_location` (string, required): Location information (e.g., book title, chapter, page)

## Validation Rules

### Question Validation
- Content must be 1-1000 characters long
- Content must not be empty or only whitespace
- If selected_text is provided, it must be 1-500 characters long

### Book Content Chunk Validation
- Content must be 10-2000 characters long (to ensure meaningful chunks)
- Book_id must exist in the book catalog
- Embedding must be a valid vector representation
- Document_position must be a non-negative integer

### Answer Validation
- Content must be provided and not only whitespace
- Confidence_score must be between 0.0 and 1.0 if provided
- Question_id must reference an existing question

### Source Reference Validation
- Relevance_score must be between 0.0 and 1.0
- Content_snippet must be a substring of the referenced book content chunk
- Source_location must be non-empty

## State Transitions

### Question States
- **pending**: Question has been received but not yet processed
- **processing**: Retrieval and answer generation is in progress
- **completed**: Answer has been generated successfully
- **insufficient_data**: No relevant book content found to answer the question
- **error**: An error occurred during processing

### Answer States
- **draft**: Initial answer generated but not yet validated
- **validated**: Answer verified to be based only on retrieved content
- **published**: Answer provided to the user

## Relationships

- **Question** 1 → * **Source Reference**: A question may result in multiple source references
- **Answer** 1 → 1 **Question**: Each answer corresponds to exactly one question
- **Source Reference** * → 1 **Book Content Chunk**: Multiple references may point to the same content chunk
- **Book Content Chunk** 1 → * **Source Reference**: A chunk can be referenced by multiple source references